# GET endpoint for retrieving user device key
# Uses TelemetryController which was the original implementation
wormchat.device_key:
  path: '/api/v1/user/device-key'
  defaults:
    _controller: '\Drupal\wormchat\Controller\TelemetryController::getDeviceKey'
  requirements:
    _access: 'TRUE'
  methods: [GET]

# ===== NEW ROUTE FOR FETCHING WORM STATE =====
wormchat.state:
  path: '/api/v1/worm/state'
  defaults:
    _controller: '\Drupal\wormchat\Controller\TelemetryController::getWormState'
  requirements:
    _access: 'TRUE'

# ===== VIDEO ROUTES =====
# Get video for specific worm state
wormchat.video.by_state:
  path: '/api/worm/video/{state}'
  defaults:
    _controller: '\Drupal\wormchat\Controller\WormVideoController::getVideoByState'
  requirements:
    _permission: 'access content'
  methods: [GET]

# Get all available worm state videos
wormchat.video.all:
  path: '/api/worm/videos'
  defaults:
    _controller: '\Drupal\wormchat\Controller\WormVideoController::getAllVideos'
  requirements:
    _permission: 'access content'
  methods: [GET]

# Get list of available worm states
wormchat.video.states:
  path: '/api/worm/video-states'
  defaults:
    _controller: '\Drupal\wormchat\Controller\WormVideoController::getAvailableStates'
  requirements:
    _permission: 'access content'
  methods: [GET]

# Check if video exists for state
wormchat.video.exists:
  path: '/api/worm/video/{state}/exists'
  defaults:
    _controller: '\Drupal\wormchat\Controller\WormVideoController::checkVideoExists'
  requirements:
    _permission: 'access content'
  methods: [GET]

# Get a random video file for a state
wormchat.video.random:
  path: '/api/worm/video/{state}/random'
  defaults:
    _controller: '\Drupal\wormchat\Controller\WormVideoController::getRandomVideoForState'
  requirements:
    _permission: 'access content'
  methods: [GET]

# Device setup page - for new users to flash firmware
wormchat.setup:
  path: '/setup'
  defaults:
    _controller: '\Drupal\wormchat\Controller\WormSetupController::setupPage'
    _title: 'Device Setup'
  requirements:
    _user_is_logged_in: 'TRUE'

# API endpoint for device provisioning - receives token from ESP32
wormchat.device.provision:
  path: '/api/wormchat/device-provision'
  defaults:
    _controller: '\Drupal\wormchat\Controller\WormSetupController::provisionDevice'
  requirements:
    _user_is_logged_in: 'TRUE'
  methods: [POST]

# REST endpoint for device token storage (receives email + token from device)
wormchat.device_token:
  path: '/api/v1/user/device-token'
  defaults:
    _controller: '\Drupal\wormchat\Controller\DeviceTokenController::storeToken'
    _format: 'json'
  requirements:
    _access: 'TRUE'
    _format: 'json'
  methods: [POST]

# Telemetry endpoint for sending feeding data to ThingsBoard
wormchat.telemetry:
  path: '/api/wormchat/telemetry'
  defaults:
    _controller: '\Drupal\wormchat\Controller\TelemetryController::sendTelemetry'
    _format: 'json'
  requirements:
    _access: 'TRUE'
    _format: 'json'
  methods: [POST]

# ===== FIRST-TIME CHAT ROUTES =====
# Check if this is the user's first time chatting
wormchat.first_chat_check:
  path: '/api/worm/first-chat-check'
  defaults:
    _controller: '\Drupal\wormchat\Controller\WormChatApiController::checkFirstChat'
  requirements:
    _user_is_logged_in: 'TRUE'
  methods: [GET]

# Mark the first chat as seen
wormchat.first_chat_mark_seen:
  path: '/api/worm/first-chat-mark-seen'
  defaults:
    _controller: '\Drupal\wormchat\Controller\WormChatApiController::markFirstChatSeen'
  requirements:
    _user_is_logged_in: 'TRUE'
  methods: [POST]
