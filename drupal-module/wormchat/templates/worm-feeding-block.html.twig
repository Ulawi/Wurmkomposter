<div id="feeding-wrapper" class="feeding-wrapper container-fluid">

  {# ===== COLOR CATEGORIES ROW ===== #}
  <div class="color-categories-row">
    {# ===== ITERATE OVER ALL COLORS FROM JS CONFIG ===== #}
    {# Note: Colors are defined in wormFeeding.js FOOD_COLORS object #}
    {% set colors = [
      { name: 'red', label: 'Red' },
      { name: 'orange', label: 'Orange' },
      { name: 'yellow', label: 'Yellow' },
      { name: 'green', label: 'Green' },
      { name: 'blue', label: 'Blue' },
      { name: 'violet', label: 'Violet' },
      { name: 'brown', label: 'Brown' },
      { name: 'black', label: 'Black' },
      { name: 'white', label: 'White' }
    ] %}

    {% for color in colors %}
      <button
        class="color-category-btn"
        data-color="{{ color.name }}"
        aria-label="Filter by {{ color.label }} foods"
        {% if color.name == 'green' %}aria-pressed="true"{% endif %}
        title="Show {{ color.label }} foods"
      >
        <span class="color-swatch"></span>  {# ===== Color set by CSS custom property from JavaScript ===== #}
      </button>
    {% endfor %}
  </div>

  <!-- Scrollable GALLERY (also a drop zone) -->
  <div class="food-gallery-scroll" id="galleryDropZone">
    <div class="food-gallery-grid">
      {% if foods %}
        {% for food in foods %}
          <div class="food-item" 
               draggable="true"
               data-food-key="{{ food.name }}"
               data-food-src="{{ food.src }}"
               data-color="{{ food.color }}">
            <img src="{{ food.src }}" alt="{{ food.name }}" draggable="false" />
            <div class="food-label">{{ food.name }}</div>
          </div>
        {% endfor %}
      {% else %}
        <p>{{ 'No food items available.'|t }}</p>
      {% endif %}
    </div>
  </div>

  <!-- CHOPPING BOARD ROW: 100% width -->
  <div class="board-row row g-2">
    <div class="col-12 d-flex justify-content-center">
      <div id="choppingBoard" class="chopping-board" aria-live="polite" style="width: 100%; max-width: 600px;">
        <div class="board-instruction"></div>
        <div id="boardItems" class="board-items"></div>
      </div>
    </div>
  </div>

  <!-- CONTROLS ROW: Knife • Cups • Feeding Done (Responsive) -->
  <!-- Desktop (≥768px): All in one row (25% / 50% / 25%) with cups centered -->
  <!-- Mobile (<768px): Stack vertically, each full width -->
  <div class="controls-row" style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: center; min-height: 120px; justify-content: center;">
    
    <!-- Knife: 25% on desktop, 100% on mobile -->
    <div class="knife-container" style="flex: 0 0 calc(25% - 0.67rem); display: flex; justify-content: center; align-items: center; min-height: 100px;">
      <img id="chopBtn" 
           class="chop-button" 
           src="/modules/custom/wormchat/images/knife.png" 
           alt="Kleinschneiden" 
           style="width: 100%; height: 100%; object-fit: contain; cursor: pointer; max-width: 100%; max-height: 100%; padding: 0.5rem;" />
    </div>

    <!-- Cups: 50% on desktop, 100% on mobile - CENTERED -->
    <div class="cups-container" style="flex: 0 0 calc(50% - 0.67rem); display: flex; gap: 1rem; justify-content: center; align-items: center;">
      <img class="cup" 
           data-cups="1" 
           data-cup-id="cup-1" 
           src="/modules/custom/wormchat/images/1cups_empty.png" 
           alt="1 cup" 
           draggable="false"
           style="max-height: 100px; width: auto; flex-shrink: 0;" />
      <img class="cup" 
           data-cups="2" 
           data-cup-id="cup-2" 
           src="/modules/custom/wormchat/images/2cups_empty.png" 
           alt="2 cups" 
           draggable="false"
           style="max-height: 100px; width: auto; flex-shrink: 0;" />
    </div>

    <!-- Feeding Done: 25% on desktop, 100% on mobile -->
    <div class="feeding-done-container" style="flex: 0 0 calc(25% - 0.67rem); display: flex; justify-content: center; align-items: center; min-height: 100px;">
      <img id="feedingDone" 
           class="feeding-done-button" 
           src="/modules/custom/wormchat/images/give_cups_empty.png" 
           alt="Feeding done" 
           draggable="false"
           style="width: 100%; height: 100%; object-fit: contain; cursor: pointer; max-width: 100%; max-height: 150px; padding: 0.5rem;" />
    </div>

  </div>

  <!-- Media Query Override for Mobile: Stack vertically -->
  <style>
    @media (max-width: 767px) {
      .controls-row {
        flex-direction: column !important;
        min-height: auto !important;
        justify-content: center !important;
      }
      
      .knife-container,
      .cups-container,
      .feeding-done-container {
        flex: 0 0 100% !important;
        min-height: 80px !important;
      }
      
      .knife-container #chopBtn {
        max-width: 200px !important;
        max-height: 200px !important;
      }
    }
    }
  </style>

</div>

{# ===== INLINE SCRIPT: Initialize CSS custom properties from JS FOOD_COLORS config ===== #}
<script>
  // ===== Sync JS FOOD_COLORS config to CSS custom properties ===== 
  document.addEventListener('DOMContentLoaded', function() {
    if (window.FOOD_COLORS) {
      const root = document.documentElement;
      // Set CSS custom properties for each color from FOOD_COLORS
      for (const [colorName, colorConfig] of Object.entries(window.FOOD_COLORS)) {
        root.style.setProperty('--food-color-' + colorName, colorConfig.hex);
      }
      console.log('CSS custom properties initialized from FOOD_COLORS');
    } else {
      console.warn('window.FOOD_COLORS not available - colors will use fallback values');
    }
  });
</script>
